#!/bin/sh
images_dir="../frontend/public/images"
metadata_dir="../frontend/public/metadata"

# Create metadata directory if it doesn't exist
mkdir -p "$metadata_dir"

for image in "$images_dir"/*; do
    [ -f "$image" ] || continue
    image_name=$(basename "$image")
    # Remove the file extension
    description="${image_name%.jpg}"
    # Remove newline and spaces from the image name
    trimmed_name=$(printf "%s" "$image_name" | tr -d '\n\r ')
    # Use -w0 to avoid newline wrapping in the base64 output
    encoded_name=$(printf "%s" "$trimmed_name" | base64 -w0)
    # Remove any accidental spaces/newlines and take the last 16 characters
    nft_name=$(printf "%s" "$encoded_name" | tr -d '\n\r= ' | tr -d "="| tail -c 16 )
    metadata_file="$metadata_dir/${image_name}.json"
    url="https://blockchain-project-live.vercel.app/images/$image_name"
    
    cat <<EOF > "$metadata_file"
{
  "name": "$nft_name",
  "description": "$description",
  "image": "$url"
}
EOF
done